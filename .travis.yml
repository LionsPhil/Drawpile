language: cpp

sudo: false

os:
    - linux

# The version of Clang available seems to be broken/too old.

compiler:
    - gcc

# Some of our required dependencies aren't in Travis' whitelist, so we can't do
# this the new way yet.
#
# Doing it the old way puts us on an Ubuntu 12.04 LTS host, so we need PPAs to
# get sufficiently recent tools and libraries. The non-test toolchain PPA
# misses out packages for 12.04 for some reason.

sudo: false

addons:
    apt:
        sources:
            - kalakris-cmake
            - ubuntu-sdk-team
            - ubuntu-toolchain-r-test
        packages:
            - cmake
            - g++-4.9
            - libgif-dev
            - qtbase5-dev
            - qtmultimedia5-dev
            - libqt5svg5-dev

# For some reason, CMake in this hacked-up environment is setting an include
# path of:
#   /usr/lib/x86_64-linux-gnu/qt5/mkspecs/linux-g++-64
# when the actual location of qplatformdefs.h is:
#   /usr/share/qt5/mkspecs/linux-g++-64/
# so we egregiously hack around this with CMAKE_CXX_FLAGS until Travis get a
# newer environment because I've already burnt two weekends on trying to do it
# properly.
#
# -DTOOLS=on is currently disabled because dprec2txt can't find
# QCoreApplication.
#
# There is currently no 'test' target.
#
# Making VERBOSE=1 is handy for diagnosing build problems but masks compiler
# warnings; Travis doesn't do anything to highlight them in the log.

script:
    - mkdir build
    - cd build && CC=gcc-4.9 CXX=g++-4.9 cmake .. -DCMAKE_BUILD_TYPE=debug -DCMAKE_CXX_FLAGS="-I /usr/share/qt5/mkspecs/linux-g++-64/" && make -j 2 VERBOSE=1

# Don't try to build 2.x-series branches since we don't have the dependencies
# for them (we currently depend on bundled ones which have been removed). Could
# do this with 'only: stable-1.x', but want to be inclusive of PRs.

branches:
    except:
        - master
